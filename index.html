<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星际探险家</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: #fff;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .game-container {
            display: flex;
            flex: 1;
            padding: 20px;
            gap: 20px;
        }
        
        .game-area {
            flex: 3;
            position: relative;
            border: 2px solid #4a4e8c;
            border-radius: 10px;
            overflow: hidden;
            background: #0a0a1a;
        }
        
        #gameCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .ui-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .panel {
            background: rgba(16, 18, 46, 0.8);
            border: 1px solid #4a4e8c;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 0 15px rgba(74, 78, 140, 0.5);
        }
        
        .stats-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            background: rgba(30, 33, 70, 0.6);
            border-radius: 8px;
        }
        
        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #6cf;
        }
        
        .controls-panel {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .btn {
            background: linear-gradient(to bottom, #4a4e8c, #2a2d5c);
            border: none;
            border-radius: 5px;
            color: white;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background: linear-gradient(to bottom, #5a5e9c, #3a3d6c);
            transform: translateY(-2px);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .upgrades-panel {
            overflow-y: auto;
            max-height: 300px;
        }
        
        .upgrade-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(30, 33, 70, 0.6);
            border-radius: 8px;
        }
        
        .progress-bar {
            height: 8px;
            background: #2a2d5c;
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #4a4e8c, #6cf);
            border-radius: 4px;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(16, 18, 46, 0.9);
            border-bottom: 2px solid #4a4e8c;
        }
        
        .game-title {
            font-size: 1.8em;
            font-weight: bold;
            background: linear-gradient(to right, #6cf, #aaf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .game-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(16, 18, 46, 0.9);
            padding: 20px 40px;
            border-radius: 10px;
            border: 2px solid #6cf;
            text-align: center;
            z-index: 100;
            display: none;
        }
        
        .minimap {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 150px;
            height: 150px;
            background: rgba(16, 18, 46, 0.7);
            border: 2px solid #4a4e8c;
            border-radius: 10px;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div class="game-header">
        <div class="game-title">星际探险家</div>
        <div class="score">分数: <span id="score">0</span></div>
    </div>
    
    <div class="game-container">
        <div class="game-area">
            <canvas id="gameCanvas"></canvas>
            <div class="minimap"></div>
            <div class="game-message" id="gameMessage">
                <h2 id="messageTitle">游戏开始</h2>
                <p id="messageText">收集资源，升级飞船，探索宇宙！</p>
                <button class="btn" id="messageBtn">开始游戏</button>
            </div>
        </div>
        
        <div class="ui-panel">
            <div class="panel stats-panel">
                <div class="stat-item">
                    <div>生命值</div>
                    <div class="stat-value" id="health">100</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="healthBar" style="width: 100%"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <div>能量</div>
                    <div class="stat-value" id="energy">100</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="energyBar" style="width: 100%"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <div>燃料</div>
                    <div class="stat-value" id="fuel">100</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="fuelBar" style="width: 100%"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <div>护盾</div>
                    <div class="stat-value" id="shield">100</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="shieldBar" style="width: 100%"></div>
                    </div>
                </div>
            </div>
            
            <div class="panel controls-panel">
                <h3>飞船控制</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <button class="btn" id="moveUp">↑ 前进</button>
                    <button class="btn" id="moveLeft">← 左转</button>
                    <button class="btn" id="moveDown">↓ 后退</button>
                    <button class="btn" id="moveRight">→ 右转</button>
                </div>
                <button class="btn" id="fireBtn">发射武器</button>
                <button class="btn" id="collectBtn">收集资源</button>
                <button class="btn" id="shieldBtn">激活护盾</button>
            </div>
            
            <div class="panel upgrades-panel">
                <h3>飞船升级</h3>
                <div class="upgrade-item">
                    <div>
                        <div>引擎升级</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 30%"></div>
                        </div>
                    </div>
                    <button class="btn">升级</button>
                </div>
                <div class="upgrade-item">
                    <div>
                        <div>武器升级</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 10%"></div>
                        </div>
                    </div>
                    <button class="btn">升级</button>
                </div>
                <div class="upgrade-item">
                    <div>
                        <div>护盾升级</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 20%"></div>
                        </div>
                    </div>
                    <button class="btn">升级</button>
                </div>
                <div class="upgrade-item">
                    <div>
                        <div>采集器升级</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 5%"></div>
                        </div>
                    </div>
                    <button class="btn">升级</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 游戏主类
        class SpaceExplorer {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.gameMessage = document.getElementById('gameMessage');
                this.messageTitle = document.getElementById('messageTitle');
                this.messageText = document.getElementById('messageText');
                this.messageBtn = document.getElementById('messageBtn');
                
                // 游戏状态
                this.gameState = 'menu'; // menu, playing, paused, gameOver
                this.score = 0;
                
                // 玩家飞船
                this.player = {
                    x: this.canvas.width / 2,
                    y: this.canvas.height / 2,
                    width: 40,
                    height: 60,
                    speed: 0,
                    maxSpeed: 5,
                    rotation: 0,
                    health: 100,
                    maxHealth: 100,
                    energy: 100,
                    maxEnergy: 100,
                    fuel: 100,
                    maxFuel: 100,
                    shield: 100,
                    maxShield: 100,
                    shieldActive: false
                };
                
                // 游戏对象
                this.asteroids = [];
                this.enemies = [];
                this.resources = [];
                this.projectiles = [];
                this.particles = [];
                
                // 控制状态
                this.keys = {};
                this.mouse = { x: 0, y: 0, down: false };
                
                // 初始化
                this.init();
                this.setupEventListeners();
                this.showMessage('星际探险家', '收集资源，升级飞船，探索宇宙！', '开始游戏');
            }
            
            init() {
                // 设置画布尺寸
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());
                
                // 生成初始游戏对象
                this.generateAsteroids(15);
                this.generateResources(10);
                
                // 开始游戏循环
                this.gameLoop();
            }
            
            resizeCanvas() {
                this.canvas.width = this.canvas.parentElement.clientWidth;
                this.canvas.height = this.canvas.parentElement.clientHeight;
            }
            
            setupEventListeners() {
                // 键盘控制
                document.addEventListener('keydown', (e) => {
                    this.keys[e.key] = true;
                    
                    // 空格键暂停
                    if (e.key === ' ' && this.gameState === 'playing') {
                        this.togglePause();
                    }
                });
                
                document.addEventListener('keyup', (e) => {
                    this.keys[e.key] = false;
                });
                
                // 鼠标控制
                this.canvas.addEventListener('mousemove', (e) => {
                    const rect = this.canvas.getBoundingClientRect();
                    this.mouse.x = e.clientX - rect.left;
                    this.mouse.y = e.clientY - rect.top;
                });
                
                this.canvas.addEventListener('mousedown', () => {
                    this.mouse.down = true;
                    if (this.gameState === 'playing') {
                        this.fireWeapon();
                    }
                });
                
                this.canvas.addEventListener('mouseup', () => {
                    this.mouse.down = false;
                });
                
                // 按钮控制
                document.getElementById('moveUp').addEventListener('mousedown', () => this.keys['ArrowUp'] = true);
                document.getElementById('moveUp').addEventListener('mouseup', () => this.keys['ArrowUp'] = false);
                document.getElementById('moveDown').addEventListener('mousedown', () => this.keys['ArrowDown'] = true);
                document.getElementById('moveDown').addEventListener('mouseup', () => this.keys['ArrowDown'] = false);
                document.getElementById('moveLeft').addEventListener('mousedown', () => this.keys['ArrowLeft'] = true);
                document.getElementById('moveLeft').addEventListener('mouseup', () => this.keys['ArrowLeft'] = false);
                document.getElementById('moveRight').addEventListener('mousedown', () => this.keys['ArrowRight'] = true);
                document.getElementById('moveRight').addEventListener('mouseup', () => this.keys['ArrowRight'] = false);
                
                document.getElementById('fireBtn').addEventListener('click', () => this.fireWeapon());
                document.getElementById('collectBtn').addEventListener('click', () => this.collectResource());
                document.getElementById('shieldBtn').addEventListener('click', () => this.toggleShield());
                
                // 消息按钮
                this.messageBtn.addEventListener('click', () => {
                    if (this.gameState === 'menu') {
                        this.startGame();
                    } else if (this.gameState === 'gameOver') {
                        this.restartGame();
                    } else if (this.gameState === 'paused') {
                        this.togglePause();
                    }
                });
            }
            
            showMessage(title, text, buttonText) {
                this.messageTitle.textContent = title;
                this.messageText.textContent = text;
                this.messageBtn.textContent = buttonText;
                this.gameMessage.style.display = 'block';
            }
            
            hideMessage() {
                this.gameMessage.style.display = 'none';
            }
            
            startGame() {
                this.gameState = 'playing';
                this.hideMessage();
                this.score = 0;
                document.getElementById('score').textContent = this.score;
                
                // 重置玩家状态
                this.player.health = this.player.maxHealth;
                this.player.energy = this.player.maxEnergy;
                this.player.fuel = this.player.maxFuel;
                this.player.shield = this.player.maxShield;
                this.updateUI();
            }
            
            togglePause() {
                this.gameState = this.gameState === 'playing' ? 'paused' : 'playing';
                if (this.gameState === 'paused') {
                    this.showMessage('游戏暂停', '点击继续游戏', '继续');
                } else {
                    this.hideMessage();
                }
            }
            
            gameOver() {
                this.gameState = 'gameOver';
                this.showMessage('游戏结束', `你的得分: ${this.score}`, '重新开始');
            }
            
            restartGame() {
                // 重置游戏对象
                this.asteroids = [];
                this.enemies = [];
                this.resources = [];
                this.projectiles = [];
                this.particles = [];
                
                // 重新生成
                this.generateAsteroids(15);
                this.generateResources(10);
                
                this.startGame();
            }
            
            updateUI() {
                // 更新状态条
                document.getElementById('health').textContent = Math.round(this.player.health);
                document.getElementById('healthBar').style.width = `${(this.player.health / this.player.maxHealth) * 100}%`;
                
                document.getElementById('energy').textContent = Math.round(this.player.energy);
                document.getElementById('energyBar').style.width = `${(this.player.energy / this.player.maxEnergy) * 100}%`;
                
                document.getElementById('fuel').textContent = Math.round(this.player.fuel);
                document.getElementById('fuelBar').style.width = `${(this.player.fuel / this.player.maxFuel) * 100}%`;
                
                document.getElementById('shield').textContent = Math.round(this.player.shield);
                document.getElementById('shieldBar').style.width = `${(this.player.shield / this.player.maxShield) * 100}%`;
                
                // 更新分数
                document.getElementById('score').textContent = this.score;
            }
            
            generateAsteroids(count) {
                for (let i = 0; i < count; i++) {
                    this.asteroids.push({
                        x: Math.random() * this.canvas.width,
                        y: Math.random() * this.canvas.height,
                        radius: Math.random() * 30 + 20,
                        speedX: Math.random() * 2 - 1,
                        speedY: Math.random() * 2 - 1,
                        rotation: 0,
                        rotationSpeed: Math.random() * 0.02 - 0.01
                    });
                }
            }
            
            generateResources(count) {
                for (let i = 0; i < count; i++) {
                    this.resources.push({
                        x: Math.random() * this.canvas.width,
                        y: Math.random() * this.canvas.height,
                        type: Math.floor(Math.random() * 3), // 0: 能源, 1: 燃料, 2: 材料
                        value: Math.random() * 20 + 10,
                        radius: 15
                    });
                }
            }
            
            updatePlayer() {
                // 旋转控制
                if (this.keys['ArrowLeft']) {
                    this.player.rotation -= 0.05;
                }
                if (this.keys['ArrowRight']) {
                    this.player.rotation += 0.05;
                }
                
                // 移动控制
                if (this.keys['ArrowUp'] && this.player.fuel > 0) {
                    this.player.speed = Math.min(this.player.speed + 0.1, this.player.maxSpeed);
                    this.player.fuel -= 0.05;
                    
                    // 添加推进粒子
                    this.addParticles(
                        this.player.x - Math.sin(this.player.rotation) * this.player.height / 2,
                        this.player.y + Math.cos(this.player.rotation) * this.player.height / 2,
                        3,
                        this.player.rotation + Math.PI
                    );
                } else if (this.keys['ArrowDown'] && this.player.fuel > 0) {
                    this.player.speed = Math.max(this.player.speed - 0.2, -this.player.maxSpeed / 2);
                    this.player.fuel -= 0.02;
                } else {
                    // 自然减速
                    this.player.speed *= 0.98;
                }
                
                // 应用移动
                this.player.x += Math.sin(this.player.rotation) * this.player.speed;
                this.player.y -= Math.cos(this.player.rotation) * this.player.speed;
                
                // 边界检查
                if (this.player.x < 0) this.player.x = this.canvas.width;
                if (this.player.x > this.canvas.width) this.player.x = 0;
                if (this.player.y < 0) this.player.y = this.canvas.height;
                if (this.player.y > this.canvas.height) this.player.y = 0;
                
                // 能量恢复
                if (this.player.energy < this.player.maxEnergy) {
                    this.player.energy += 0.05;
                }
                
                // 护盾消耗
                if (this.player.shieldActive && this.player.shield > 0) {
                    this.player.shield -= 0.2;
                    if (this.player.shield <= 0) {
                        this.player.shieldActive = false;
                    }
                } else if (!this.player.shieldActive && this.player.shield < this.player.maxShield) {
                    this.player.shield += 0.05;
                }
            }
            
            updateAsteroids() {
                this.asteroids.forEach(asteroid => {
                    asteroid.x += asteroid.speedX;
                    asteroid.y += asteroid.speedY;
                    asteroid.rotation += asteroid.rotationSpeed;
                    
                    // 边界检查
                    if (asteroid.x < -asteroid.radius) asteroid.x = this.canvas.width + asteroid.radius;
                    if (asteroid.x > this.canvas.width + asteroid.radius) asteroid.x = -asteroid.radius;
                    if (asteroid.y < -asteroid.radius) asteroid.y = this.canvas.height + asteroid.radius;
                    if (asteroid.y > this.canvas.height + asteroid.radius) asteroid.y = -asteroid.radius;
                    
                    // 碰撞检测
                    const dx = this.player.x - asteroid.x;
                    const dy = this.player.y - asteroid.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < asteroid.radius + this.player.width / 2) {
                        // 碰撞处理
                        const damage = asteroid.radius / 5;
                        if (this.player.shieldActive) {
                            this.player.shield -= damage * 2;
                            this.addParticles(asteroid.x, asteroid.y, 10);
                        } else {
                            this.player.health -= damage;
                            this.addParticles(asteroid.x, asteroid.y, 15);
                        }
                        
                        // 击退效果
                        this.player.x += Math.sin(this.player.rotation) * -10;
                        this.player.y -= Math.cos(this.player.rotation) * -10;
                    }
                });
            }
            
            updateProjectiles() {
                for (let i = this.projectiles.length - 1; i >= 0; i--) {
                    const proj = this.projectiles[i];
                    
                    // 移动
                    proj.x += Math.sin(proj.rotation) * proj.speed;
                    proj.y -= Math.cos(proj.rotation) * proj.speed;
                    
                    // 生命周期
                    proj.life--;
                    if (proj.life <= 0) {
                        this.projectiles.splice(i, 1);
                        continue;
                    }
                    
                    // 边界检查
                    if (proj.x < 0 || proj.x > this.canvas.width || 
                        proj.y < 0 || proj.y > this.canvas.height) {
                        this.projectiles.splice(i, 1);
                        continue;
                    }
                    
                    // 碰撞检测 - 与小行星
                    for (let j = this.asteroids.length - 1; j >= 0; j--) {
                        const asteroid = this.asteroids[j];
                        const dx = proj.x - asteroid.x;
                        const dy = proj.y - asteroid.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < asteroid.radius) {
                            // 击中小行星
                            this.projectiles.splice(i, 1);
                            
                            // 小行星分裂或消失
                            if (asteroid.radius > 20) {
                                // 分裂
                                const newRadius = asteroid.radius / 2;
                                this.asteroids.push({
                                    x: asteroid.x,
                                    y: asteroid.y,
                                    radius: newRadius,
                                    speedX: Math.random() * 3 - 1.5,
                                    speedY: Math.random() * 3 - 1.5,
                                    rotation: 0,
                                    rotationSpeed: Math.random() * 0.03 - 0.015
                                });
                                this.asteroids.push({
                                    x: asteroid.x,
                                    y: asteroid.y,
                                    radius: newRadius,
                                    speedX: Math.random() * 3 - 1.5,
                                    speedY: Math.random() * 3 - 1.5,
                                    rotation: 0,
                                    rotationSpeed: Math.random() * 0.03 - 0.015
                                });
                            }
                            
                            this.asteroids.splice(j, 1);
                            this.score += Math.round(asteroid.radius);
                            this.addParticles(asteroid.x, asteroid.y, 15);
                            break;
                        }
                    }
                }
            }
            
            updateParticles() {
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    const p = this.particles[i];
                    
                    // 移动
                    p.x += Math.sin(p.rotation) * p.speed;
                    p.y -= Math.cos(p.rotation) * p.speed;
                    
                    // 生命周期
                    p.life--;
                    if (p.life <= 0) {
                        this.particles.splice(i, 1);
                        continue;
                    }
                    
                    // 缩小
                    p.radius *= 0.95;
                }
            }
            
            checkResourceCollection() {
                for (let i = this.resources.length - 1; i >= 0; i--) {
                    const resource = this.resources[i];
                    const dx = this.player.x - resource.x;
                    const dy = this.player.y - resource.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < resource.radius + this.player.width / 2) {
                        // 收集资源
                        switch (resource.type) {
                            case 0: // 能源
                                this.player.energy = Math.min(this.player.maxEnergy, this.player.energy + resource.value);
                                break;
                            case 1: // 燃料
                                this.player.fuel = Math.min(this.player.maxFuel, this.player.fuel + resource.value);
                                break;
                            case 2: // 材料
                                this.score += resource.value;
                                break;
                        }
                        
                        this.resources.splice(i, 1);
                        this.addParticles(resource.x, resource.y, 8);
                        
                        // 偶尔生成新资源
                        if (Math.random() < 0.3) {
                            this.generateResources(1);
                        }
                    }
                }
            }
            
            fireWeapon() {
                if (this.player.energy >= 10) {
                    this.player.energy -= 10;
                    
                    this.projectiles.push({
                        x: this.player.x + Math.sin(this.player.rotation) * this.player.height / 2,
                        y: this.player.y - Math.cos(this.player.rotation) * this.player.height / 2,
                        rotation: this.player.rotation,
                        speed: 10,
                        life: 100,
                        radius: 3
                    });
                    
                    // 武器发射粒子
                    this.addParticles(
                        this.player.x + Math.sin(this.player.rotation) * this.player.height / 2,
                        this.player.y - Math.cos(this.player.rotation) * this.player.height / 2,
                        5,
                        this.player.rotation
                    );
                }
            }
            
            collectResource() {
                // 模拟资源收集
                if (this.player.energy >= 5) {
                    this.player.energy -= 5;
                    
                    // 查找最近的资源
                    let nearestResource = null;
                    let minDistance = 150; // 收集范围
                    
                    this.resources.forEach(resource => {
                        const dx = this.player.x - resource.x;
                        const dy = this.player.y - resource.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < minDistance) {
                            minDistance = distance;
                            nearestResource = resource;
                        }
                    });
                    
                    if (nearestResource) {
                        // 收集资源
                        switch (nearestResource.type) {
                            case 0: // 能源
                                this.player.energy = Math.min(this.player.maxEnergy, this.player.energy + nearestResource.value * 1.5);
                                break;
                            case 1: // 燃料
                                this.player.fuel = Math.min(this.player.maxFuel, this.player.fuel + nearestResource.value * 1.5);
                                break;
                            case 2: // 材料
                                this.score += nearestResource.value * 1.5;
                                break;
                        }
                        
                        // 移除资源并添加粒子
                        const index = this.resources.indexOf(nearestResource);
                        if (index > -1) {
                            this.resources.splice(index, 1);
                            this.addParticles(nearestResource.x, nearestResource.y, 10);
                            
                            // 生成新资源
                            this.generateResources(1);
                        }
                    }
                }
            }
            
            toggleShield() {
                if (this.player.shield > 10) {
                    this.player.shieldActive = !this.player.shieldActive;
                } else {
                    this.player.shieldActive = false;
                }
            }
            
            addParticles(x, y, count, direction = null) {
                for (let i = 0; i < count; i++) {
                    const angle = direction !== null ? 
                        direction + (Math.random() * 0.6 - 0.3) : 
                        Math.random() * Math.PI * 2;
                    
                    this.particles.push({
                        x: x,
                        y: y,
                        rotation: angle,
                        speed: Math.random() * 3 + 1,
                        life: Math.random() * 30 + 20,
                        radius: Math.random() * 5 + 2
                    });
                }
            }
            
            drawPlayer() {
                this.ctx.save();
                this.ctx.translate(this.player.x, this.player.y);
                this.ctx.rotate(this.player.rotation);
                
                // 飞船主体
                this.ctx.fillStyle = '#4a8';
                this.ctx.beginPath();
                this.ctx.moveTo(0, -this.player.height / 2);
                this.ctx.lineTo(-this.player.width / 2, this.player.height / 2);
                this.ctx.lineTo(this.player.width / 2, this.player.height / 2);
                this.ctx.closePath();
                this.ctx.fill();
                
                // 飞船细节
                this.ctx.fillStyle = '#6cf';
                this.ctx.fillRect(-this.player.width / 4, -this.player.height / 4, this.player.width / 2, this.player.height / 4);
                
                // 护盾效果
                if (this.player.shieldActive) {
                    this.ctx.strokeStyle = 'rgba(100, 200, 255, 0.7)';
                    this.ctx.lineWidth = 3;
                    this.ctx.beginPath();
                    this.ctx.arc(0, 0, this.player.width / 1.5, 0, Math.PI * 2);
                    this.ctx.stroke();
                }
                
                this.ctx.restore();
            }
            
            drawAsteroids() {
                this.asteroids.forEach(asteroid => {
                    this.ctx.save();
                    this.ctx.translate(asteroid.x, asteroid.y);
                    this.ctx.rotate(asteroid.rotation);
                    
                    this.ctx.fillStyle = '#765';
                    this.ctx.beginPath();
                    this.ctx.arc(0, 0, asteroid.radius, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    // 小行星细节
                    this.ctx.fillStyle = '#654';
                    this.ctx.beginPath();
                    this.ctx.arc(asteroid.radius * 0.3, -asteroid.radius * 0.3, asteroid.radius * 0.2, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    this.ctx.beginPath();
                    this.ctx.arc(-asteroid.radius * 0.4, asteroid.radius * 0.2, asteroid.radius * 0.15, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    this.ctx.restore();
                });
            }
            
            drawResources() {
                this.resources.forEach(resource => {
                    this.ctx.save();
                    this.ctx.translate(resource.x, resource.y);
                    
                    let color;
                    switch (resource.type) {
                        case 0: color = '#ff0'; break; // 能源 - 黄色
                        case 1: color = '#f80'; break; // 燃料 - 橙色
                        case 2: color = '#8f8'; break; // 材料 - 绿色
                    }
                    
                    this.ctx.fillStyle = color;
                    this.ctx.beginPath();
                    this.ctx.arc(0, 0, resource.radius, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    // 发光效果
                    this.ctx.shadowColor = color;
                    this.ctx.shadowBlur = 10;
                    this.ctx.beginPath();
                    this.ctx.arc(0, 0, resource.radius * 0.7, 0, Math.PI * 2);
                    this.ctx.fill();
                    this.ctx.shadowBlur = 0;
                    
                    this.ctx.restore();
                });
            }
            
            drawProjectiles() {
                this.projectiles.forEach(proj => {
                    this.ctx.save();
                    this.ctx.translate(proj.x, proj.y);
                    this.ctx.rotate(proj.rotation);
                    
                    this.ctx.fillStyle = '#6cf';
                    this.ctx.fillRect(-proj.radius, -proj.radius, proj.radius * 2, proj.radius * 2);
                    
                    // 发光效果
                    this.ctx.shadowColor = '#6cf';
                    this.ctx.shadowBlur = 10;
                    this.ctx.fillRect(-proj.radius, -proj.radius, proj.radius * 2, proj.radius * 2);
                    this.ctx.shadowBlur = 0;
                    
                    this.ctx.restore();
                });
            }
            
            drawParticles() {
                this.particles.forEach(p => {
                    this.ctx.save();
                    this.ctx.translate(p.x, p.y);
                    
                    const alpha = p.life / 50;
                    this.ctx.fillStyle = `rgba(255, ${100 + p.life}, ${100 + p.life}, ${alpha})`;
                    
                    this.ctx.beginPath();
                    this.ctx.arc(0, 0, p.radius, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    this.ctx.restore();
                });
            }
            
            drawBackground() {
                // 星空背景
                this.ctx.fillStyle = '#0a0a1a';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // 绘制星星
                this.ctx.fillStyle = 'white';
                for (let i = 0; i < 100; i++) {
                    const x = (i * 123.45) % this.canvas.width;
                    const y = (i * 67.89) % this.canvas.height;
                    const size = (i % 3) * 0.5 + 0.5;
                    
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, size, 0, Math.PI * 2);
                    this.ctx.fill();
                }
            }
            
            drawUI() {
                // 绘制小地图
                const minimap = document.querySelector('.minimap');
                const minimapCtx = minimap.getContext('2d');
                
                minimapCtx.fillStyle = 'rgba(10, 10, 26, 0.8)';
                minimapCtx.fillRect(0, 0, minimap.width, minimap.height);
                
                // 绘制玩家位置
                const scaleX = minimap.width / this.canvas.width;
                const scaleY = minimap.height / this.canvas.height;
                
                minimapCtx.fillStyle = '#4a8';
                minimapCtx.fillRect(
                    this.player.x * scaleX - 2, 
                    this.player.y * scaleY - 2, 
                    4, 4
                );
                
                // 绘制资源位置
                this.resources.forEach(resource => {
                    let color;
                    switch (resource.type) {
                        case 0: color = '#ff0'; break;
                        case 1: color = '#f80'; break;
                        case 2: color = '#8f8'; break;
                    }
                    
                    minimapCtx.fillStyle = color;
                    minimapCtx.fillRect(
                        resource.x * scaleX - 1, 
                        resource.y * scaleY - 1, 
                        2, 2
                    );
                });
            }
            
            gameLoop() {
                if (this.gameState === 'playing') {
                    // 更新游戏状态
                    this.updatePlayer();
                    this.updateAsteroids();
                    this.updateProjectiles();
                    this.updateParticles();
                    this.checkResourceCollection();
                    this.updateUI();
                    
                    // 检查游戏结束条件
                    if (this.player.health <= 0 || this.player.fuel <= 0) {
                        this.gameOver();
                    }
                }
                
                // 绘制游戏
                this.drawBackground();
                this.drawAsteroids();
                this.drawResources();
                this.drawProjectiles();
                this.drawParticles();
                this.drawPlayer();
                this.drawUI();
                
                // 继续游戏循环
                requestAnimationFrame(() => this.gameLoop());
            }
        }
        
        // 启动游戏
        window.addEventListener('load', () => {
            new SpaceExplorer();
        });
    </script>
</body>
</html>
