<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>后启示录生存者 | 3D生存游戏</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/PointerLockControls.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #0a0a0a;
            color: #e0e0e0;
            overflow: hidden;
            height: 100vh;
        }
        
        #gameContainer {
            position: relative;
            width: 100%;
            height: 100vh;
        }
        
        #canvasContainer {
            width: 100%;
            height: 100%;
        }
        
        #ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        #hud {
            position: absolute;
            bottom: 20px;
            left: 20px;
            padding: 15px;
            background: rgba(20, 20, 20, 0.7);
            border-radius: 8px;
            border: 1px solid #444;
            backdrop-filter: blur(5px);
        }
        
        .stat {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .stat-label {
            width: 80px;
            font-size: 14px;
            color: #aaa;
        }
        
        .stat-value {
            font-weight: bold;
            color: #e0e0e0;
        }
        
        .bar {
            width: 150px;
            height: 8px;
            background: #333;
            border-radius: 4px;
            margin-left: 10px;
            overflow: hidden;
        }
        
        .bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        .health-fill {
            background: linear-gradient(to right, #c33, #e55);
        }
        
        .hunger-fill {
            background: linear-gradient(to right, #c93, #ea5);
        }
        
        .thirst-fill {
            background: linear-gradient(to right, #39c, #5ae);
        }
        
        #resources {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(20, 20, 20, 0.7);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #444;
            backdrop-filter: blur(5px);
        }
        
        .resource {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .resource-icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            background: #444;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(10, 10, 20, 0.9), rgba(5, 5, 15, 0.9));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        
        #gameTitle {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #e0e0e0;
            text-shadow: 0 0 10px rgba(200, 100, 50, 0.5);
            letter-spacing: 2px;
        }
        
        #gameSubtitle {
            font-size: 18px;
            margin-bottom: 40px;
            color: #aaa;
            max-width: 600px;
            text-align: center;
            line-height: 1.6;
        }
        
        #startButton {
            background: linear-gradient(to right, #c33, #e55);
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 1px;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(200, 50, 50, 0.3);
        }
        
        #startButton:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(200, 50, 50, 0.4);
        }
        
        #controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(20, 20, 20, 0.7);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #444;
            backdrop-filter: blur(5px);
            font-size: 14px;
            color: #aaa;
        }
        
        .control-item {
            margin-bottom: 5px;
        }
        
        #message {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20, 20, 20, 0.8);
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid #444;
            backdrop-filter: blur(5px);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        #crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            pointer-events: none;
        }
        
        .crosshair-dot {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
        }
        
        .crosshair-line {
            position: absolute;
            background: rgba(255, 255, 255, 0.5);
        }
        
        .horizontal {
            width: 12px;
            height: 2px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .vertical {
            width: 2px;
            height: 12px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        #dayCounter {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(20, 20, 20, 0.7);
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #444;
            backdrop-filter: blur(5px);
            font-size: 14px;
        }
        
        .danger {
            color: #e55;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="canvasContainer"></div>
        
        <div id="ui">
            <div id="startScreen">
                <h1 id="gameTitle">后启示录生存者</h1>
                <p id="gameSubtitle">核战后的世界一片荒芜。在这个被遗弃的城市废墟中，你需要寻找食物、水源和庇护所，同时警惕变异的生物和其他幸存者。你的目标是尽可能长时间地生存下去。</p>
                <button id="startButton">开始生存</button>
            </div>
            
            <div id="hud">
                <div class="stat">
                    <div class="stat-label">生命值</div>
                    <div class="stat-value" id="healthValue">100</div>
                    <div class="bar">
                        <div class="bar-fill health-fill" id="healthBar" style="width: 100%"></div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-label">饥饿度</div>
                    <div class="stat-value" id="hungerValue">100</div>
                    <div class="bar">
                        <div class="bar-fill hunger-fill" id="hungerBar" style="width: 100%"></div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-label">口渴度</div>
                    <div class="stat-value" id="thirstValue">100</div>
                    <div class="bar">
                        <div class="bar-fill thirst-fill" id="thirstBar" style="width: 100%"></div>
                    </div>
                </div>
            </div>
            
            <div id="resources">
                <div class="resource">
                    <div class="resource-icon">F</div>
                    <div class="stat-label">食物</div>
                    <div class="stat-value" id="foodValue">0</div>
                </div>
                <div class="resource">
                    <div class="resource-icon">W</div>
                    <div class="stat-label">水</div>
                    <div class="stat-value" id="waterValue">0</div>
                </div>
                <div class="resource">
                    <div class="resource-icon">M</div>
                    <div class="stat-label">材料</div>
                    <div class="stat-value" id="materialValue">0</div>
                </div>
            </div>
            
            <div id="dayCounter">
                生存天数: <span id="dayValue">1</span>
            </div>
            
            <div id="message"></div>
            
            <div id="crosshair">
                <div class="crosshair-dot"></div>
                <div class="crosshair-line horizontal"></div>
                <div class="crosshair-line vertical"></div>
            </div>
            
            <div id="controls">
                <div class="control-item">W/A/S/D - 移动</div>
                <div class="control-item">鼠标 - 环顾四周</div>
                <div class="control-item">空格 - 跳跃</div>
                <div class="control-item">E - 互动/拾取</div>
                <div class="control-item">F - 手电筒</div>
            </div>
        </div>
    </div>

    <script>
        // 游戏变量
        let scene, camera, renderer, controls;
        let player, objects = [];
        let clock = new THREE.Clock();
        
        // 游戏状态
        let gameStarted = false;
        let playerStats = {
            health: 100,
            hunger: 100,
            thirst: 100,
            food: 0,
            water: 0,
            materials: 0,
            day: 1
        };
        
        // 初始化Three.js场景
        function init() {
            // 创建场景
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x222233, 10, 50);
            
            // 创建相机
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.y = 1.7;
            
            // 创建渲染器
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('canvasContainer').appendChild(renderer.domElement);
            
            // 添加光源
            const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 50;
            directionalLight.shadow.camera.left = -20;
            directionalLight.shadow.camera.right = 20;
            directionalLight.shadow.camera.top = 20;
            directionalLight.shadow.camera.bottom = -20;
            scene.add(directionalLight);
            
            // 创建地面
            const groundGeometry = new THREE.PlaneGeometry(100, 100);
            const groundMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x3a3a3a,
                roughness: 0.8
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // 添加一些随机建筑物和障碍物
            createEnvironment();
            
            // 创建玩家
            player = new THREE.Object3D();
            player.position.set(0, 0, 0);
            scene.add(player);
            player.add(camera);
            
            // 添加指针锁定控制
            controls = new THREE.PointerLockControls(camera, document.body);
            
            // 事件监听器
            document.getElementById('startButton').addEventListener('click', startGame);
            document.addEventListener('keydown', onKeyDown);
            window.addEventListener('resize', onWindowResize);
            
            // 开始动画循环
            animate();
        }
        
        // 创建游戏环境
        function createEnvironment() {
            // 创建一些建筑物
            for (let i = 0; i < 20; i++) {
                const width = Math.random() * 5 + 3;
                const height = Math.random() * 10 + 5;
                const depth = Math.random() * 5 + 3;
                
                const buildingGeometry = new THREE.BoxGeometry(width, height, depth);
                const buildingMaterial = new THREE.MeshLambertMaterial({ 
                    color: 0x555555,
                    roughness: 0.9
                });
                const building = new THREE.Mesh(buildingGeometry, buildingMaterial);
                
                building.position.x = Math.random() * 80 - 40;
                building.position.z = Math.random() * 80 - 40;
                building.position.y = height / 2;
                
                building.castShadow = true;
                building.receiveShadow = true;
                
                scene.add(building);
                objects.push(building);
            }
            
            // 添加一些废弃的车辆
            for (let i = 0; i < 10; i++) {
                const carGeometry = new THREE.BoxGeometry(3, 1.2, 1.5);
                const carMaterial = new THREE.MeshLambertMaterial({ 
                    color: 0x444444,
                    roughness: 0.7
                });
                const car = new THREE.Mesh(carGeometry, carMaterial);
                
                car.position.x = Math.random() * 80 - 40;
                car.position.z = Math.random() * 80 - 40;
                car.position.y = 0.6;
                
                car.rotation.y = Math.random() * Math.PI * 2;
                
                car.castShadow = true;
                car.receiveShadow = true;
                
                scene.add(car);
                objects.push(car);
            }
            
            // 添加一些资源（食物、水、材料）
            addResources();
        }
        
        // 添加资源
        function addResources() {
            // 食物资源
            for (let i = 0; i < 8; i++) {
                const foodGeometry = new THREE.SphereGeometry(0.3, 8, 6);
                const foodMaterial = new THREE.MeshLambertMaterial({ color: 0xcc3333 });
                const food = new THREE.Mesh(foodGeometry, foodMaterial);
                
                food.position.x = Math.random() * 80 - 40;
                food.position.z = Math.random() * 80 - 40;
                food.position.y = 0.3;
                
                food.userData = { type: 'food' };
                
                scene.add(food);
                objects.push(food);
            }
            
            // 水资源
            for (let i = 0; i < 8; i++) {
                const waterGeometry = new THREE.CylinderGeometry(0.3, 0.3, 0.6, 8);
                const waterMaterial = new THREE.MeshLambertMaterial({ color: 0x3366cc });
                const water = new THREE.Mesh(waterGeometry, waterMaterial);
                
                water.position.x = Math.random() * 80 - 40;
                water.position.z = Math.random() * 80 - 40;
                water.position.y = 0.3;
                
                water.userData = { type: 'water' };
                
                scene.add(water);
                objects.push(water);
            }
            
            // 材料资源
            for (let i = 0; i < 10; i++) {
                const materialGeometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
                const material = new THREE.MeshLambertMaterial({ color: 0xcccc33 });
                const materialObj = new THREE.Mesh(materialGeometry, material);
                
                materialObj.position.x = Math.random() * 80 - 40;
                materialObj.position.z = Math.random() * 80 - 40;
                materialObj.position.y = 0.25;
                
                materialObj.userData = { type: 'material' };
                
                scene.add(materialObj);
                objects.push(materialObj);
            }
        }
        
        // 开始游戏
        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            controls.lock();
            gameStarted = true;
            showMessage('寻找食物、水和材料来生存下去！', 5000);
            
            // 开始游戏循环
            setInterval(updateGame, 1000);
        }
        
        // 更新游戏状态
        function updateGame() {
            if (!gameStarted) return;
            
            // 减少饥饿和口渴
            playerStats.hunger = Math.max(0, playerStats.hunger - 2);
            playerStats.thirst = Math.max(0, playerStats.thirst - 3);
            
            // 如果饥饿或口渴为0，减少生命值
            if (playerStats.hunger === 0 || playerStats.thirst === 0) {
                playerStats.health = Math.max(0, playerStats.health - 5);
            }
            
            // 随机事件
            if (Math.random() < 0.1) {
                showMessage('你听到远处有奇怪的声音...', 3000);
            }
            
            // 更新UI
            updateUI();
            
            // 检查游戏结束
            if (playerStats.health <= 0) {
                gameOver();
            }
        }
        
        // 更新UI
        function updateUI() {
            document.getElementById('healthValue').textContent = playerStats.health;
            document.getElementById('hungerValue').textContent = playerStats.hunger;
            document.getElementById('thirstValue').textContent = playerStats.thirst;
            document.getElementById('foodValue').textContent = playerStats.food;
            document.getElementById('waterValue').textContent = playerStats.water;
            document.getElementById('materialValue').textContent = playerStats.materials;
            document.getElementById('dayValue').textContent = playerStats.day;
            
            document.getElementById('healthBar').style.width = playerStats.health + '%';
            document.getElementById('hungerBar').style.width = playerStats.hunger + '%';
            document.getElementById('thirstBar').style.width = playerStats.thirst + '%';
            
            // 如果生命值低于30%，添加危险样式
            if (playerStats.health < 30) {
                document.getElementById('healthValue').classList.add('danger');
            } else {
                document.getElementById('healthValue').classList.remove('danger');
            }
        }
        
        // 显示消息
        function showMessage(text, duration) {
            const messageElement = document.getElementById('message');
            messageElement.textContent = text;
            messageElement.style.opacity = 1;
            
            setTimeout(() => {
                messageElement.style.opacity = 0;
            }, duration);
        }
        
        // 游戏结束
        function gameOver() {
            showMessage('游戏结束！你生存了 ' + playerStats.day + ' 天', 10000);
            gameStarted = false;
            controls.unlock();
            
            // 重新加载页面以重新开始游戏
            setTimeout(() => {
                location.reload();
            }, 10000);
        }
        
        // 键盘事件处理
        function onKeyDown(event) {
            if (!gameStarted) return;
            
            switch(event.code) {
                case 'KeyE': // 互动/拾取
                    tryCollectResource();
                    break;
                case 'KeyF': // 使用食物
                    if (playerStats.food > 0) {
                        playerStats.food--;
                        playerStats.hunger = Math.min(100, playerStats.hunger + 30);
                        showMessage('你吃了一些食物', 2000);
                    } else {
                        showMessage('你没有食物', 2000);
                    }
                    break;
                case 'KeyR': // 使用水
                    if (playerStats.water > 0) {
                        playerStats.water--;
                        playerStats.thirst = Math.min(100, playerStats.thirst + 40);
                        showMessage('你喝了一些水', 2000);
                    } else {
                        showMessage('你没有水', 2000);
                    }
                    break;
            }
        }
        
        // 尝试收集资源
        function tryCollectResource() {
            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(new THREE.Vector2(0, 0), camera);
            
            const intersects = raycaster.intersectObjects(objects);
            
            if (intersects.length > 0) {
                const object = intersects[0].object;
                
                if (object.userData.type) {
                    switch(object.userData.type) {
                        case 'food':
                            playerStats.food++;
                            showMessage('获得了食物', 2000);
                            break;
                        case 'water':
                            playerStats.water++;
                            showMessage('获得了水', 2000);
                            break;
                        case 'material':
                            playerStats.materials++;
                            showMessage('获得了材料', 2000);
                            break;
                    }
                    
                    // 从场景中移除资源
                    scene.remove(object);
                    objects.splice(objects.indexOf(object), 1);
                }
            }
        }
        
        // 窗口大小调整
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // 动画循环
        function animate() {
            requestAnimationFrame(animate);
            
            if (gameStarted && controls.isLocked) {
                // 这里可以添加玩家移动逻辑
            }
            
            renderer.render(scene, camera);
        }
        
        // 初始化游戏
        init();
    </script>
</body>
</html>
